<html>
    <head>
        <!-- Mapbox -->
        <script src="https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.js"></script>
        <link href="https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.css" rel="stylesheet" />

        <link rel="stylesheet" href="styles.css" />

        <!-- Font -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Libre+Franklin:wght@400;700&display=swap" rel="stylesheet">
        <style> @import url('https://fonts.googleapis.com/css2?family=Libre+Franklin:wght@400;700&display=swap'); </style>

        
        <!-- Slider -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/11.1.0/nouislider.min.css" />
        <script src='https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/11.1.0/nouislider.min.js'></script>

        <!-- Moment.js -->
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.1/moment.min.js"></script>
    </head>

    <body>
        <nav id="menu"></nav>
        <div id="map"></div>
        <div id="info"></div>
        <script src="rangeSlider.js"></script>
        <script>
            mapboxgl.accessToken = "pk.eyJ1IjoiYW5hbm1heSIsImEiOiJjbDk0azVhbWMwMmNzM3dyNWpraW5pYXo3In0.ABTXYKit9qNDRvSBlFcalA";
            const bounds = [
            [-79.432709, 43.628221], // Southwest coordinates
            [-79.341908, 43.700811] // Northeast coordinates
            ];
            // create map
            const map = new mapboxgl.Map({
                container: "map", // container ID
                // Choose from Mapbox's core styles, or make your own style with Mapbox Studio
                style: "mapbox://styles/ananmay/clb46qysm000l14kyvn8q1gjh", // style URL
                center: [-79.380331532, 43.646497454], // // starting center in [lng, lat]
                zoom: 13.6,
                // pitch: 60, // pitch in degrees
                // bearing: -20, // bearing in degrees
                maxBounds: bounds // Set the map's geographical boundaries.
            });

            
                    
        // SLIDER

        const sliderOptions = {
            elm: 'slider-control',
            layer: 'photos',
            source: 'photos',
            input: false,
            controlWidth: '400px',
            minProperty: 'date',
            maxProperty: 'date',
            // sliderMin: '1878-01-01T00:00:00.000Z',
            // sliderMax: '2000-12-31T00:00:00.000Z',
            // filterMin: '1878-01-01T00:00:00.000Z',
            // filterMax: '2000-12-31T00:00:00.000Z',
            propertyType: 'iso8601',
            rangeDescriptionFormat: 'shortDate',
            descriptionPrefix: 'Date:',
            dontFilterOnLoad:true
            }

            map.addControl(new RangeSlider(sliderOptions, 'top-left'));

            // ADDING SOURCE IMAGES

            map.on("load", async () => {
                
                const geojson_url = await fetch(
                    'https://raw.githubusercontent.com/ananmaysharan/gardinerarchive/main/images.geojson'
                );
                
                const geojson_data = await geojson_url.json();

                
                // ADDING AS SYMBOL LAYER
            
                const images = geojson_data.features.map(feature => ({
                        url: feature.properties.thumb_url,
                        id: feature.properties.id
                        }));
                
                Promise.all(
                images.map(img => new Promise((resolve, reject) => {
                    map.loadImage(img.url, function (error, res) {
                        if (error) throw error;
                        map.addImage(img.id, res)
                        resolve();
                    })
                }))
                ).then(console.log("Images Loaded"));

                map.addSource("photos", {
                    type: "geojson",
                    data: geojson_data,
                });

                map.addLayer({
                    id: "photos",
                    type: "symbol",
                    source: "photos",
                    layout: {
                            'icon-image': ['get','id'], // reference the image
                            'icon-ignore-placement': true,
                            'icon-size': 0.25,
                            'icon-allow-overlap':true,
                            }
                });
                
                
                map.addSource('shoreline_overlay', {
                type: 'geojson',
                // Use a URL for the value for the `data` property.
                data: 'https://raw.githubusercontent.com/ananmaysharan/gardinerarchive/main/shorelines_polygons.geojson'
                });

                map.addLayer({
                'id': '1818',
                'type': 'fill',
                'source': 'shoreline_overlay',
                'layout': {
                    'visibility': 'none'
                    },
                'paint': {
                    'fill-color': '#409cf7', // blue color fill
                    'fill-opacity': 0.8
                    },
                filter: ["all", ["==", "year", 1818]]
                });

                map.addLayer({
                'id': '1884',
                'type': 'fill',
                'source': 'shoreline_overlay',
                'layout': {
                    'visibility': 'none'
                    },
                'paint': {
                    'fill-color': '#01468a', // blue color fill
                    'fill-opacity': 0.8
                    },
                filter: ["all", ["==", "year", 1884]]
                });

                map.addLayer({
                'id': '1910',
                'type': 'fill',
                'source': 'shoreline_overlay',
                'layout': {
                    'visibility': 'none'
                    },
                'paint': {
                    'fill-color': '#00264d', // blue color fill
                    'fill-opacity': 0.8
                    },
                filter: ["all", ["==", "year", 1910]]
                });

                map.addLayer({
                'id': '2022',
                'type': 'fill',
                'source': 'shoreline_overlay',
                'layout': {
                    'visibility': 'none'
                    },
                'paint': {
                    'fill-color': '#001429', // blue color fill
                    'fill-opacity': 0.8
                    },
                filter: ["all", ["==", "year", 2022]]
                });

                // When a click event occurs on a feature in the places layer, open a popup at the
                // location of the feature, with description HTML from its properties.
                map.on('click', 'photos', (e) => {
                // Copy coordinates array.
                const coordinates = e.features[0].geometry.coordinates.slice();
                const description = e.features[0].properties.title;
                const year = e.features[0].properties.date.substring(0, 4);
                const image = e.features[0].properties.url;
                
                // Ensure that if the map is zoomed out such that multiple
                // copies of the feature are visible, the popup appears
                // over the copy being pointed to.
                while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
                coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
                }
                
                new mapboxgl.Popup()
                .setLngLat(coordinates)
                .setHTML(description + "<br>" + year + "<img src='" + image + "'" + " class=popupImage " + "/>")
                .addTo(map);
                });
                
                // Change the cursor to a pointer when the mouse is over the places layer.
                map.on('mouseenter', 'places', () => {
                map.getCanvas().style.cursor = 'pointer';
                });
                
                // Change it back to a pointer when it leaves.
                map.on('mouseleave', 'places', () => {
                map.getCanvas().style.cursor = '';
                });
            

                // TITLE

                document.getElementById('info').innerHTML = `<?xml version="1.0" encoding="UTF-8"?>
<svg version="1.1" viewBox="0 0 360 82" xmlns="http://www.w3.org/2000/svg">
<title>maplogo</title>
<g fill="none" fill-rule="evenodd">
<g transform="translate(15 15)">
<path d="m0 14.074c0 2.3206 0.70593 4.2192 2.1178 5.6959 1.4119 1.4767 3.2355 2.2301 5.5003 2.2301 2.2648 0 4.0884-0.75344 5.5003-2.2301 1.4119-1.4767 2.1178-3.3754 2.1178-5.6959v-13.622h-3.9708v13.803c0 2.2904-1.2059 3.8274-3.6472 3.8274-2.4413 0-3.6472-1.5069-3.6472-3.8877v-13.742h-3.9708v13.622zm24.211 7.474v-13.532l7.3827 13.532h3.6178v-21.096h-4.0002v13.532l-7.2945-13.532h-3.6767v21.096h3.9708zm19.769-17.178h3.5001c1.3236 0 2.2061 0.45204 2.7061 1.326 0.5 0.87399 0.76475 2.5315 0.76475 4.9726-0.088248 5.8466-1.0001 6.9617-3.6472 6.9617h-3.3237v-13.26zm3.3237 17.178c5.0885 0 7.6181-3.6165 7.6181-10.879 0-6.811-2.4708-10.216-7.4417-10.216h-7.4709v21.096h7.2945zm26.476 0v-3.9178h-9.0593v-5.2137h8.2356v-3.9178h-8.2356v-4.1287h9.0593v-3.9178h-13.03v21.096h13.03zm10.239 0v-8.2877h2.3531l3.8237 8.2877h4.4119l-4.1475-9.011c2.2648-1.2959 3.265-3.0137 3.265-5.6959 0-1.8082-0.61758-3.3151-1.8533-4.5507-1.2057-1.2356-2.6764-1.8384-4.4119-1.8384h-7.412v21.096h3.9709zm0-17.178h3.4411c1.2063 0 2.2942 0.99448 2.2942 2.5315-0.088301 2.0493-1.5001 2.5014-2.2942 2.4411h-3.4411v-4.9726zm45.627 9.9151c-0.029433 2.2904-1.2063 3.7972-3.6471 3.7972-1.324 0-2.2648-0.54249-2.8241-1.5973-0.55871-1.0548-0.85305-3.0137-0.85305-5.8164 0-4.9425 1.0885-6.7507 3.6771-6.7507 2.2059 0 3.4117 1.4466 3.6766 4.3096l3.706-0.51229c-0.14717-2.2-0.91192-4.0384-2.2942-5.5151-1.3529-1.4767-3.059-2.2-5.0883-2.2-4.7062 0-7.6475 3.6466-7.6475 10.669 0 7.7452 2.853 11.331 7.6475 11.331 2.2648 0 4.0881-0.75344 5.4999-2.2301 1.4118-1.4767 2.1182-3.3754 2.1182-5.6959v-3.5562h-8.53v3.7672h4.5591zm11.151 7.263 1.2057-3.6768h7.0299l1.2057 3.6768h4.2358l-7.1182-21.096h-3.5l-7.1476 21.096h4.0886zm4.7351-14.827 2.2359 7.2328h-4.4419l2.2059-7.2328zm17.328 14.827v-8.2877h2.3531l3.8237 8.2877h4.4119l-4.147-9.011c2.2648-1.2959 3.2645-3.0137 3.2645-5.6959 0-1.8082-0.61758-3.3151-1.8527-4.5507-1.2063-1.2356-2.6769-1.8384-4.4119-1.8384h-7.4125v21.096h3.9709zm0-17.178h3.4416c1.2057 0 2.2942 0.99448 2.2942 2.5315-0.088301 2.0493-1.5001 2.5014-2.2942 2.4411h-3.4416v-4.9726zm19.093 0h3.5c1.3235 0 2.2059 0.45204 2.7058 1.326 0.50037 0.87399 0.76528 2.5315 0.76528 4.9726-0.088301 5.8466-1.0002 6.9617-3.6477 6.9617h-3.3234v-13.26zm3.3234 17.178c5.0889 0 7.6181-3.6165 7.6181-10.879 0-6.811-2.4703-10.216-7.4415-10.216h-7.4709v21.096h7.2943zm26.035 0v-3.9178h-4.5885v-13.26h4.5885v-3.9178h-13.177v3.9178h4.6179v13.26h-4.6179v3.9178h13.177zm10.004 0v-13.532l7.3826 13.532h3.6182v-21.096h-4.0003v13.532l-7.2948-13.532h-3.6766v21.096h3.9709zm29.858 0v-3.9178h-9.0593v-5.2137h8.2356v-3.9178h-8.2356v-4.1287h9.0593v-3.9178h-13.03v21.096h13.03zm10.239 0v-8.2877h2.3531l3.8237 8.2877h4.4119l-4.147-9.011c2.2648-1.2959 3.265-3.0137 3.265-5.6959 0-1.8082-0.61811-3.3151-1.8533-4.5507-1.2057-1.2356-2.6764-1.8384-4.4119-1.8384h-7.412v21.096h3.9704zm0-17.178h3.4416c1.2057 0 2.2942 0.99448 2.2942 2.5315-0.088301 2.0493-1.5001 2.5014-2.2942 2.4411h-3.4416v-4.9726z" fill="#6ECCB1"/>
<path id="Combined-Shape" d="m244.49 30c1.7831 0 3.299 0.62996 4.5774 1.92 1.2779 1.26 1.9318 2.82 1.9318 4.68 0 1.86-0.6241 3.42-1.8426 4.71-1.219 1.26-2.7944 1.89-4.6667 1.89h-3.478v7.8h-4.0128v-21zm0.029744 3.9h-3.5077v5.4h3.5077c1.3969 0 2.4667-1.23 2.4667-2.7 0-1.68-1.159-2.7-2.4667-2.7z" fill="#022423"/>
<polygon id="Path" points="175 51 175 47.1 166.14 47.1 166.14 30 162 30 162 51" fill="#022423"/>
<path id="Combined-Shape" d="m152.79 30 7.212 21h-4.2911l-1.2222-3.66h-7.1226l-1.2216 3.66h-4.1425l7.2419-21h3.5461zm-1.8473 6.24-2.235 7.2h4.4999l-2.2648-7.2z" fill="#022423"/>
<path id="a" d="m227.79 30 7.212 21h-4.2911l-1.2222-3.66h-7.1226l-1.2216 3.66h-4.1425l7.2419-21h3.5461zm-1.8473 6.24-2.235 7.2h4.4999l-2.2648-7.2z" fill="#022423"/>
<path id="Path" d="m134.55 43.147c-0.24675 2.7329-1.3698 4.1137-3.4246 4.1137-1.2332 0-2.1096-0.51779-2.6305-1.5246-0.52042-1.0069-0.79459-2.8767-0.79459-5.5521 0-4.7178 1.0139-6.4438 3.4251-6.4438 2.0548 0 3.1779 1.3808 3.4246 4.1137l3.452-0.60413c-0.10967-2.0425-0.79459-3.7685-2.0822-5.1493-1.2602-1.4096-2.8494-2.1-4.7944-2.1-4.3837 0-7.1234 3.4808-7.1234 10.184 0 7.3932 2.6574 10.816 7.1234 10.816 1.9451 0 3.5343-0.69042 4.7944-2.0712 1.2876-1.4096 1.9725-3.1356 2.0822-5.1781l-3.452-0.60413z" fill="#022423"/>
<path d="m96.127 30c1.6688 0 3.0829 0.6 4.2423 1.83 1.1882 1.23 1.782 2.73 1.782 4.53 0 2.67-0.96177 4.38-3.1395 5.67l3.9881 8.97h-4.2428l-3.6768-8.25h-2.2622v8.25h-3.8183v-21zm0 3.9h-3.3088v4.95h3.3088c0.76365 0.060027 2.1212-0.38996 2.2061-2.43 0-1.53-1.0467-2.52-2.2061-2.52z" fill="#022423"/>
<polygon id="Path" points="202.8 51 202.8 37.98 204.79 44.22 207.21 44.22 209.2 37.98 209.2 51 213 51 213 30 209.37 30 206 40.77 202.63 30 199 30 199 51" fill="#022423"/>
<polygon id="Path" points="30 51 30 47.1 25.473 47.1 25.473 33.9 30 33.9 30 30 17 30 17 33.9 21.556 33.9 21.556 47.1 17 47.1 17 51" fill="#022423"/>
<polygon id="Path" points="120 51 120 47.1 115.47 47.1 115.47 33.9 120 33.9 120 30 107 30 107 33.9 111.56 33.9 111.56 47.1 107 47.1 107 51" fill="#022423"/>
<polygon points="277 5 330 5 330 1 277 1" fill="#6ECCB1"/>
<g transform="translate(34 30)" fill="#022423" fill-rule="nonzero">
<path id="Path" d="m7.2205 21c4.1614 0 6.7795-2.0453 6.7795-6.2798 0-4.4362-2.7283-6.0494-6.5866-6.5391-2.6181-0.34568-3.1693-1.2099-3.1693-2.4198 0-1.2099 0.82677-2.1317 2.5354-2.1317 1.5984 0 2.811 0.63374 2.9764 2.2181h3.7205c-0.22047-4.3786-3.0866-5.8477-6.6693-5.8477-3.6102 0-6.2835 2.3621-6.2835 5.9342s2.0669 5.6173 5.6772 6.0782c3.2244 0.4321 3.9134 1.2099 3.9134 2.9095 0 1.5267-1.0197 2.3909-2.7835 2.3909-1.8189 0-3.3071-0.8642-3.5276-3.1687h-3.8031c0.1378 5.0988 3.5276 6.856 7.2205 6.856z"/>
</g>
<g transform="translate(0 30)" fill="#022423" fill-rule="nonzero">
<polygon id="b" points="0 20.97 4.163 21 4.163 12.156 9.837 12.156 9.837 21 14 21 14 0 9.837 0 9.837 8.3704 4.163 8.3704 4.163 0 0 0"/>
</g>
<g transform="translate(51 30)" fill="#022423" fill-rule="nonzero">
<polygon points="5.6004 21 9.3715 21 9.3715 3.7563 15 3.7563 15 0 0 0 0 3.7563 5.6004 3.7563"/>
</g>
<g transform="translate(70 30)" fill="#022423" fill-rule="nonzero">
<path d="m14 8.774c0-6.6164-2.8442-8.774-6.9586-8.774-4.0316 0-7.0414 2.3014-7.0414 8.6877v3.8836c0 6.0986 3.2032 8.4288 7.0414 8.4288 4.1144 0 6.9586-2.3301 6.9586-8.4288v-3.7973zm-3.7002 3.7973c-0.08284 3.3082-1.215 4.689-3.2584 4.689-1.9053 0-3.3412-1.4096-3.3412-4.689v-3.711c0-3.9123 1.3531-5.1205 3.3412-5.1205 1.9606 0 3.2584 1.3233 3.2584 5.0342v3.7973z"/>
</g>
</g>
</g>
</svg>`

                // MENU

                // If these two layers were not added to the map, abort
                if (!map.getLayer('1818') || !map.getLayer('1884') || !map.getLayer('1910') || !map.getLayer('2022')) {
                return;
                }
                
                // Enumerate ids of the layers.
                const toggleableLayerIds = ['1818', '1884', '1910', '2022'];
                
                // Set up the corresponding toggle button for each layer.
                for (const id of toggleableLayerIds) {
                // Skip layers that already have a button set up.
                if (document.getElementById(id)) {
                continue;
                }
                
                // Create a link.
                const link = document.createElement('a');
                link.id = id;
                link.href = '#';
                link.textContent = id;
                link.className = 'active';
                
                // Show or hide layer when the toggle is clicked.
                link.onclick = function (e) {
                const clickedLayer = this.textContent;
                e.preventDefault();
                e.stopPropagation();
                
                const visibility = map.getLayoutProperty(
                clickedLayer,
                'visibility'
                );
                
                // Toggle layer visibility by changing the layout object's visibility property.
                if (visibility === 'none') {
                map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
                this.className = '';
                } else {
                this.className = 'active';
                map.setLayoutProperty(
                clickedLayer,
                'visibility',
                'none'
                );
                }
                };
                
                const layers = document.getElementById('menu');
                layers.appendChild(link);
                }
                });
        </script>
    </body>
</html>

<html>
    <head>
        <!-- Mapbox -->
        <script src="https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.js"></script>
        <link href="https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.css" rel="stylesheet" />

        <link rel="stylesheet" href="styles.css" />

        <!-- Font -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Libre+Franklin:wght@400;700&display=swap" rel="stylesheet">
        <style> @import url('https://fonts.googleapis.com/css2?family=Libre+Franklin:wght@400;700&display=swap'); </style>

        
        <!-- Slider -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/11.1.0/nouislider.min.css" />
        <script src='https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/11.1.0/nouislider.min.js'></script>

        <!-- Moment.js -->
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.1/moment.min.js"></script>
    </head>

    <body>
        <nav id="menu"></nav>
        <div id="map"></div>
        <div id="info"></div>
        <script src="rangeSlider.js"></script>
        <script>
            mapboxgl.accessToken = "pk.eyJ1IjoiYW5hbm1heSIsImEiOiJjbDk0azVhbWMwMmNzM3dyNWpraW5pYXo3In0.ABTXYKit9qNDRvSBlFcalA";
            const bounds = [
            [-79.432709, 43.628221], // Southwest coordinates
            [-79.341908, 43.700811] // Northeast coordinates
            ];
            // create map
            const map = new mapboxgl.Map({
                container: "map", // container ID
                // Choose from Mapbox's core styles, or make your own style with Mapbox Studio
                style: "mapbox://styles/ananmay/clb46qysm000l14kyvn8q1gjh", // style URL
                center: [-79.380331532, 43.646497454], // // starting center in [lng, lat]
                zoom: 13.6,
                // pitch: 60, // pitch in degrees
                // bearing: -20, // bearing in degrees
                maxBounds: bounds // Set the map's geographical boundaries.
            });

            
                    
        // SLIDER

        const sliderOptions = {
            elm: 'slider-control',
            layer: 'photos',
            source: 'photos',
            input: false,
            controlWidth: '400px',
            minProperty: 'date',
            maxProperty: 'date',
            // sliderMin: '1878-01-01T00:00:00.000Z',
            // sliderMax: '2000-12-31T00:00:00.000Z',
            // filterMin: '1878-01-01T00:00:00.000Z',
            // filterMax: '2000-12-31T00:00:00.000Z',
            propertyType: 'iso8601',
            rangeDescriptionFormat: 'shortDate',
            descriptionPrefix: 'Date:',
            dontFilterOnLoad:true
            }

            map.addControl(new RangeSlider(sliderOptions, 'top-left'));

            // ADDING SOURCE IMAGES

            map.on("load", async () => {
                
                const geojson_url = await fetch(
                    'https://raw.githubusercontent.com/ananmaysharan/gardinerarchive/main/images.geojson'
                );
                
                const geojson_data = await geojson_url.json();

                
                // ADDING AS SYMBOL LAYER
            
                const images = geojson_data.features.map(feature => ({
                        url: feature.properties.thumb_url,
                        id: feature.properties.id
                        }));
                
                Promise.all(
                images.map(img => new Promise((resolve, reject) => {
                    map.loadImage(img.url, function (error, res) {
                        if (error) throw error;
                        map.addImage(img.id, res)
                        resolve();
                    })
                }))
                ).then(console.log("Images Loaded"));

                map.addSource("photos", {
                    type: "geojson",
                    data: geojson_data,
                });

                map.addLayer({
                    id: "photos",
                    type: "symbol",
                    source: "photos",
                    layout: {
                            'icon-image': ['get','id'], // reference the image
                            'icon-ignore-placement': true,
                            'icon-size': 0.25,
                            'icon-allow-overlap':true,
                            }
                });
                
                
                map.addSource('shoreline_overlay', {
                type: 'geojson',
                // Use a URL for the value for the `data` property.
                data: 'https://raw.githubusercontent.com/ananmaysharan/gardinerarchive/main/shorelines_polygons.geojson'
                });

                map.addLayer({
                'id': '1818',
                'type': 'fill',
                'source': 'shoreline_overlay',
                'layout': {
                    'visibility': 'none'
                    },
                'paint': {
                    'fill-color': '#409cf7', // blue color fill
                    'fill-opacity': 0.8
                    },
                filter: ["all", ["==", "year", 1818]]
                });

                map.addLayer({
                'id': '1884',
                'type': 'fill',
                'source': 'shoreline_overlay',
                'layout': {
                    'visibility': 'none'
                    },
                'paint': {
                    'fill-color': '#01468a', // blue color fill
                    'fill-opacity': 0.8
                    },
                filter: ["all", ["==", "year", 1884]]
                });

                map.addLayer({
                'id': '1910',
                'type': 'fill',
                'source': 'shoreline_overlay',
                'layout': {
                    'visibility': 'none'
                    },
                'paint': {
                    'fill-color': '#00264d', // blue color fill
                    'fill-opacity': 0.8
                    },
                filter: ["all", ["==", "year", 1910]]
                });

                map.addLayer({
                'id': '2022',
                'type': 'fill',
                'source': 'shoreline_overlay',
                'layout': {
                    'visibility': 'none'
                    },
                'paint': {
                    'fill-color': '#001429', // blue color fill
                    'fill-opacity': 0.8
                    },
                filter: ["all", ["==", "year", 2022]]
                });

                // When a click event occurs on a feature in the places layer, open a popup at the
                // location of the feature, with description HTML from its properties.
                map.on('click', 'photos', (e) => {
                // Copy coordinates array.
                const coordinates = e.features[0].geometry.coordinates.slice();
                const description = e.features[0].properties.title;
                const year = e.features[0].properties.date.substring(0, 4);
                const image = e.features[0].properties.url;
                
                // Ensure that if the map is zoomed out such that multiple
                // copies of the feature are visible, the popup appears
                // over the copy being pointed to.
                while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
                coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
                }
                
                new mapboxgl.Popup()
                .setLngLat(coordinates)
                .setHTML(description + "<br>" + year + "<img src='" + image + "'" + " class=popupImage " + "/>")
                .addTo(map);
                });
                
                // Change the cursor to a pointer when the mouse is over the places layer.
                map.on('mouseenter', 'places', () => {
                map.getCanvas().style.cursor = 'pointer';
                });
                
                // Change it back to a pointer when it leaves.
                map.on('mouseleave', 'places', () => {
                map.getCanvas().style.cursor = '';
                });
            

                // TITLE

                document.getElementById('info').innerHTML = `<svg width="674px" height="152px" viewBox="0 0 674 152" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <title>Bentway UGPRP - Identity Design (dragged)</title>
    <g id="Bentway-UGPRP---Identity-Design-(dragged)" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <path d="M24,56.1873 C24,60.5051 25.3431,64.0378 28.0292,66.7855 C30.7154,69.5331 34.185,70.935 38.494,70.935 C42.803,70.935 46.2726,69.5331 48.9587,66.7855 C51.6449,64.0378 52.988,60.5051 52.988,56.1873 L52.988,30.8415 L45.4332,30.8415 L45.4332,56.5238 C45.4332,60.7855 43.1388,63.6453 38.494,63.6453 C33.8492,63.6453 31.5548,60.8415 31.5548,56.4116 L31.5548,30.8415 L24,30.8415 L24,56.1873 Z M70.0627,70.0939 L70.0627,44.9163 L84.109,70.0939 L90.9922,70.0939 L90.9922,30.8415 L83.3815,30.8415 L83.3815,56.0191 L69.5031,30.8415 L62.5079,30.8415 L62.5079,70.0939 L70.0627,70.0939 Z M107.6753,38.1313 L114.3346,38.1313 C116.8529,38.1313 118.5318,38.9724 119.4831,40.5985 C120.4344,42.2247 120.9381,45.3088 120.9381,49.8509 C120.7702,60.7294 119.0354,62.8042 113.9989,62.8042 L107.6753,62.8042 L107.6753,38.1313 Z M113.9989,70.0939 C123.6802,70.0939 128.493,63.3649 128.493,49.8509 C128.493,37.178 123.7921,30.8415 114.3346,30.8415 L100.1205,30.8415 L100.1205,70.0939 L113.9989,70.0939 Z M164.371,70.0939 L164.371,62.8042 L147.135,62.8042 L147.135,53.1032 L162.804,53.1032 L162.804,45.8135 L147.135,45.8135 L147.135,38.1313 L164.371,38.1313 L164.371,30.8415 L139.58,30.8415 L139.58,70.0939 L164.371,70.0939 Z M183.852,70.0939 L183.852,54.6733 L188.329,54.6733 L195.604,70.0939 L203.998,70.0939 L196.107,53.3275 C200.416,50.9163 202.319,47.72 202.319,42.7294 C202.319,39.3649 201.144,36.5612 198.793,34.2621 C196.499,31.963 193.701,30.8415 190.399,30.8415 L176.297,30.8415 L176.297,70.0939 L183.852,70.0939 Z M183.852,38.1313 L190.399,38.1313 C192.694,38.1313 194.764,39.9817 194.764,42.8415 C194.596,46.6546 191.91,47.4957 190.399,47.3836 L183.852,47.3836 L183.852,38.1313 Z M270.661,56.5799 C270.605,60.8415 268.366,63.6453 263.722,63.6453 C261.203,63.6453 259.413,62.6359 258.349,60.6733 C257.286,58.7107 256.726,55.0658 256.726,49.8509 C256.726,40.6546 258.797,37.2901 263.722,37.2901 C267.919,37.2901 270.213,39.9817 270.717,45.3088 L277.768,44.3556 C277.488,40.2621 276.033,36.8415 273.403,34.0939 C270.829,31.3462 267.583,30.0004 263.722,30.0004 C254.768,30.0004 249.172,36.7855 249.172,49.8509 C249.172,64.2621 254.6,70.935 263.722,70.935 C268.031,70.935 271.5,69.5331 274.186,66.7855 C276.872,64.0378 278.216,60.5051 278.216,56.1873 L278.216,49.5705 L261.987,49.5705 L261.987,56.5799 L270.661,56.5799 Z M291.877,70.0939 L294.171,63.2527 L307.546,63.2527 L309.84,70.0939 L317.899,70.0939 L304.356,30.8415 L297.697,30.8415 L284.098,70.0939 L291.877,70.0939 Z M300.886,42.5051 L305.14,55.963 L296.689,55.963 L300.886,42.5051 Z M333.854,70.0939 L333.854,54.6733 L338.331,54.6733 L345.606,70.0939 L354,70.0939 L346.11,53.3275 C350.419,50.9163 352.321,47.72 352.321,42.7294 C352.321,39.3649 351.146,36.5612 348.796,34.2621 C346.501,31.963 343.703,30.8415 340.402,30.8415 L326.299,30.8415 L326.299,70.0939 L333.854,70.0939 Z M333.854,38.1313 L340.402,38.1313 C342.696,38.1313 344.767,39.9817 344.767,42.8415 C344.599,46.6546 341.913,47.4957 340.402,47.3836 L333.854,47.3836 L333.854,38.1313 Z M370.18,38.1313 L376.839,38.1313 C379.357,38.1313 381.036,38.9724 381.987,40.5985 C382.939,42.2247 383.443,45.3088 383.443,49.8509 C383.275,60.7294 381.54,62.8042 376.503,62.8042 L370.18,62.8042 L370.18,38.1313 Z M376.503,70.0939 C386.185,70.0939 390.997,63.3649 390.997,49.8509 C390.997,37.178 386.297,30.8415 376.839,30.8415 L362.625,30.8415 L362.625,70.0939 L376.503,70.0939 Z M426.036,70.0939 L426.036,62.8042 L417.306,62.8042 L417.306,38.1313 L426.036,38.1313 L426.036,30.8415 L400.965,30.8415 L400.965,38.1313 L409.751,38.1313 L409.751,62.8042 L400.965,62.8042 L400.965,70.0939 L426.036,70.0939 Z M445.069,70.0939 L445.069,44.9163 L459.115,70.0939 L465.999,70.0939 L465.999,30.8415 L458.388,30.8415 L458.388,56.0191 L444.509,30.8415 L437.514,30.8415 L437.514,70.0939 L445.069,70.0939 Z M501.876,70.0939 L501.876,62.8042 L484.64,62.8042 L484.64,53.1032 L500.309,53.1032 L500.309,45.8135 L484.64,45.8135 L484.64,38.1313 L501.876,38.1313 L501.876,30.8415 L477.085,30.8415 L477.085,70.0939 L501.876,70.0939 Z M521.357,70.0939 L521.357,54.6733 L525.834,54.6733 L533.109,70.0939 L541.503,70.0939 L533.613,53.3275 C537.922,50.9163 539.825,47.72 539.825,42.7294 C539.825,39.3649 538.649,36.5612 536.299,34.2621 C534.005,31.963 531.207,30.8415 527.905,30.8415 L513.803,30.8415 L513.803,70.0939 L521.357,70.0939 Z M521.357,38.1313 L527.905,38.1313 C530.199,38.1313 532.27,39.9817 532.27,42.8415 C532.102,46.6546 529.416,47.4957 527.905,47.3836 L521.357,47.3836 L521.357,38.1313 Z" id="Fill-7" fill="#6ECCB1"></path>
        <path d="M491.103,88 C494.46,88 497.314,89.1775 499.721,91.5888 C502.127,93.9439 503.358,96.8598 503.358,100.3364 C503.358,103.8131 502.183,106.729 499.889,109.1402 C497.594,111.4953 494.628,112.6729 491.103,112.6729 L491.103,112.6729 L484.555,112.6729 L484.555,127.2523 L477,127.2523 L477,88 Z M491.159,95.2897 L484.555,95.2897 L484.555,105.3831 L491.159,105.3831 C493.789,105.3831 495.803,103.0841 495.803,100.3364 C495.803,97.1962 493.621,95.2897 491.159,95.2897 L491.159,95.2897 Z" id="Combined-Shape" fill="#022423"></path>
        <polygon id="Path" fill="#022423" points="357.728 127.2523 357.728 119.9626 341.555 119.9626 341.555 88 334 88 334 127.2523"></polygon>
        <path d="M314.258,88 L327.801,127.2523 L319.743,127.2523 L317.448,120.4112 L304.073,120.4112 L301.779,127.2523 L294,127.2523 L307.599,88 L314.258,88 Z M310.789,99.6635 L306.592,113.1215 L315.042,113.1215 L310.789,99.6635 Z" id="Combined-Shape" fill="#022423"></path>
        <path d="M457.258,88 L470.801,127.2523 L462.743,127.2523 L460.448,120.4112 L447.073,120.4112 L444.779,127.2523 L437,127.2523 L450.599,88 L457.258,88 Z M453.789,99.6635 L449.592,113.1215 L458.042,113.1215 L453.789,99.6635 Z" id="Combined-Shape" fill="#022423"></path>
        <path d="M280.658399,112.571558 C280.17514,117.679442 277.97554,120.260279 273.951251,120.260279 C271.535911,120.260279 269.819572,119.292513 268.799356,117.410676 C267.7801,115.528743 267.243145,112.033931 267.243145,107.033534 C267.243145,98.2157679 269.228921,94.9897208 273.951251,94.9897208 C277.97554,94.9897208 280.17514,97.5705585 280.658399,102.678442 L287.419243,101.549302 C287.204461,97.7318368 285.863031,94.5057897 283.341259,91.9249521 C280.873182,89.2904188 277.760758,88 273.951251,88 C265.365718,88 260,94.5057897 260,107.033534 C260,120.851697 265.204632,127.25 273.951251,127.25 C277.760758,127.25 280.873182,125.959581 283.341259,123.378743 C285.863031,120.74421 287.204461,117.518163 287.419243,113.700698 L280.658399,112.571558 Z" id="Path" fill="#022423"></path>
        <path d="M207.102,88 C210.404,88 213.202,89.1215 215.496,91.4205 C217.847,93.7196 219.022,96.5233 219.022,99.8878 C219.022,104.8785 217.119,108.0747 212.81,110.486 L212.81,110.486 L220.701,127.2523 L212.306,127.2523 L205.031,111.8317 L200.555,111.8317 L200.555,127.2523 L193,127.2523 L193,88 Z M207.102,95.2897 L200.555,95.2897 L200.555,104.542 L207.102,104.542 C208.613,104.6542 211.299,103.8131 211.467,100 C211.467,97.1402 209.396,95.2897 207.102,95.2897 L207.102,95.2897 Z" id="Combined-Shape" fill="#022423"></path>
        <polygon id="Path" fill="#022423" points="410.555 127.2523 410.555 102.9159 414.528 114.5794 419.341 114.5794 423.314 102.9159 423.314 127.2523 430.869 127.2523 430.869 88 423.65 88 416.935 108.1308 410.219 88 403 88 403 127.2523"></polygon>
        <polygon id="Path" fill="#022423" points="82.071 127.2523 82.071 119.9626 73.341 119.9626 73.341 95.2897 82.071 95.2897 82.071 88 57 88 57 95.2897 65.786 95.2897 65.786 119.9626 57 119.9626 57 127.2523"></polygon>
        <polygon id="Path" fill="#022423" points="252.071 127.2523 252.071 119.9626 243.341 119.9626 243.341 95.2897 252.071 95.2897 252.071 88 227 88 227 95.2897 235.786 95.2897 235.786 119.9626 227 119.9626 227 127.2523"></polygon>
        <polygon id="Fill-9" fill="#6ECCB1" points="553 38.336 653.93 38.336 653.93 31.041015 553 31.041015"></polygon>
        <g id="S" transform="translate(88.000000, 88.000000)" fill="#022423" fill-rule="nonzero">
            <path d="M14.10631,39.25 C22.2362826,39.25 27.351166,35.4272977 27.351166,27.5126886 C27.351166,19.2211934 22.0209191,16.2061043 14.4831962,15.2908093 C9.36831276,14.6447188 8.2914952,13.0294925 8.2914952,10.7681756 C8.2914952,8.50685871 9.90672154,6.78395062 13.244856,6.78395062 C16.3676269,6.78395062 18.7366255,7.96844993 19.0596708,10.9296982 L26.3281893,10.9296982 C25.8974623,2.74588477 20.298011,0 13.2986968,0 C6.24554184,0 1.02297668,4.41495199 1.02297668,11.0912209 C1.02297668,17.7674897 5.06104252,21.590192 12.1141975,22.4516461 C18.4135802,23.2592593 19.7596022,24.712963 19.7596022,27.8895748 C19.7596022,30.7431413 17.7674897,32.3583676 14.3216735,32.3583676 C10.7681756,32.3583676 7.86076818,30.7431413 7.43004115,26.4358711 L0,26.4358711 C0.26920439,35.9657064 6.89163237,39.25 14.10631,39.25 Z" id="Path"></path>
        </g>
        <g id="H" transform="translate(24.000000, 88.000000)" fill="#022423" fill-rule="nonzero">
            <polygon id="Path" points="-2.80571453e-14 39.1947183 7.46302817 39.25 7.46302817 22.7207746 17.6348592 22.7207746 17.6348592 39.25 25.0978873 39.25 25.0978873 0 17.6348592 0 17.6348592 15.6447183 7.46302817 15.6447183 7.46302817 0 -2.80571453e-14 0"></polygon>
        </g>
        <g id="T" transform="translate(121.000000, 88.000000)" fill="#022423" fill-rule="nonzero">
            <polygon id="Path" points="11.0010563 39.25 18.4088028 39.25 18.4088028 7.02077465 29.4651408 7.02077465 29.4651408 -7.01428631e-15 -5.61142905e-14 -7.01428631e-15 -5.61142905e-14 7.02077465 11.0010563 7.02077465"></polygon>
        </g>
        <g id="O" transform="translate(156.000000, 88.000000)" fill="#022423" fill-rule="nonzero">
            <path d="M27.2599315,16.3989726 C27.2599315,4.03253425 21.7219178,0 13.7106164,0 C5.86061644,0 0,4.30136986 0,16.2376712 L0,23.4962329 C0,34.894863 6.2369863,39.25 13.7106164,39.25 C21.7219178,39.25 27.2599315,34.894863 27.2599315,23.4962329 L27.2599315,16.3989726 Z M20.055137,23.4962329 C19.8938356,29.6794521 17.6893836,32.260274 13.7106164,32.260274 C10.0006849,32.260274 7.20479452,29.6256849 7.20479452,23.4962329 L7.20479452,16.560274 C7.20479452,9.24794521 9.83938356,6.98972603 13.7106164,6.98972603 C17.5280822,6.98972603 20.055137,9.4630137 20.055137,16.3989726 L20.055137,23.4962329 Z" id="Shape"></path>
        </g>
    </g>
</svg>`

                // MENU

                // If these two layers were not added to the map, abort
                if (!map.getLayer('1818') || !map.getLayer('1884') || !map.getLayer('1910') || !map.getLayer('2022')) {
                return;
                }
                
                // Enumerate ids of the layers.
                const toggleableLayerIds = ['1818', '1884', '1910', '2022'];
                
                // Set up the corresponding toggle button for each layer.
                for (const id of toggleableLayerIds) {
                // Skip layers that already have a button set up.
                if (document.getElementById(id)) {
                continue;
                }
                
                // Create a link.
                const link = document.createElement('a');
                link.id = id;
                link.href = '#';
                link.textContent = id;
                link.className = 'active';
                
                // Show or hide layer when the toggle is clicked.
                link.onclick = function (e) {
                const clickedLayer = this.textContent;
                e.preventDefault();
                e.stopPropagation();
                
                const visibility = map.getLayoutProperty(
                clickedLayer,
                'visibility'
                );
                
                // Toggle layer visibility by changing the layout object's visibility property.
                if (visibility === 'none') {
                map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
                this.className = '';
                } else {
                this.className = 'active';
                map.setLayoutProperty(
                clickedLayer,
                'visibility',
                'none'
                );
                }
                };
                
                const layers = document.getElementById('menu');
                layers.appendChild(link);
                }
                });
        </script>
    </body>
</html>
